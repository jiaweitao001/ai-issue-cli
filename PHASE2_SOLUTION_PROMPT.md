# 阶段2：解决方案实施

基于阶段1调研，设计并实施高质量解决方案。

## 核心原则

- 🎯 **治本不治标** - 解决根因，不绕过问题
- 🔍 **参考优先** - 采用调研中的相似实现和SDK函数
- 🌐 **全局一致** - 所有CRUD操作保持一致逻辑
- 🔐 **动态验证** - CustomizeDiff使用API调用而非硬编码逻辑（使用外部API作为source of truth）
- 📝 **Schema严谨** - Optional字段优先用Default而非Computed；有格式要求必须加ValidateFunc

## 独立思考要求

- ❌ 不能查看修复该Issue的PR代码（如果存在）
- ❌ 不能查看Issue评论区中直接给出的解决方案
- ✅ 必须基于阶段1调研结果独立设计方案

---

## 实施清单

### 1. 方案设计自查

- [ ] 方案解决根因？（不是绕过）
- [ ] 参考了相似实现？
- [ ] 使用了SDK函数？
- [ ] 检查了所有CRUD位置？
- [ ] 代码更简洁？（不是更复杂）
- [ ] **Schema定义**：Optional+Default（而非Computed）？加ValidateFunc？
- [ ] **动态验证**：CustomizeDiff调用API而非硬编码？
- [ ] **文档更新**：修改公开字段必须更新.html.markdown

### 2. Git操作 ⭐

```bash
git checkout -b issue-[编号]
# 修改代码...
git add .
git commit -m "Fix #[编号]: [简短描述]

- 问题根因
- 解决方案
- 参考相似实现"
```

### 3. 代码修改

- ✅ 使用 `replace_string_in_file` / `create_file` 工具
- ✅ 所有CRUD操作同步修改
- ✅ 相关资源同步修改

### 4. 测试更新 ⭐⭐（强制）

```bash
# 找测试文件
find . -name "*_test.go" | grep [资源名]
```

**必须**：
- 测试修复场景
- 测试边界情况
- 确保向后兼容

### 5. 文档更新（如需要）

- 修改公开API → 必须更新文档
- 内部实现 → 不需要

### 6. Git提交

```bash
git log -1 --format="%H"  # 获取commit hash
```

---

## 输出要求

创建 `issue-[编号]-analysis.md`，**使用以下格式**：

```markdown
# Issue #[编号] 解决方案

## 1. 问题分析
- 问题现象
- 根本原因
- 影响范围

## 2. 代码调查
- 关键文件路径
- 相关函数/类/模块
- 发现的问题点

## 3. 解决方案
- 修复思路
- 具体实现方法

## 4. 代码修改

### Git操作记录
- 分支名：issue-XXX
- Commit Hash: [hash]

### 修改的文件
- `path/to/file.go` - 修改说明

### Commit信息
```
[完整commit message]
```

## 5. 测试修改

### 测试文件修改
- 修改的测试文件路径
- 新增或修改的测试用例
- 测试运行结果

## 6. 文档更新（如适用）
- 更新的文档文件路径
- 修改内容说明

## 7. 验证方法
- 测试步骤
- 预期结果

## 8. 潜在影响
- 是否影响其他功能
- 是否需要额外修改
```

---

## 质量标准

### ✅ 优秀方案
- 解决根因，不绕过
- 参考相似实现
- 使用SDK现有功能
- 修改范围完整
- 代码更简洁

### ❌ 常见错误
- 只增加轮询/延迟（治标）
- 自己写正则/验证（重复造轮子）
- 只改Update，不改Create（不完整）
- 代码更复杂（增加分支）
- **Schema错误**：Optional字段用Computed代替Default
- **验证缺失**：有格式要求但不加ValidateFunc
- **静态验证**：CustomizeDiff用硬编码而非API调用
- **文档遗漏**：改了Schema但不更新文档
