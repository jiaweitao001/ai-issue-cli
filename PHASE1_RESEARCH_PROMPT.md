# 阶段1：深度调研

## 核心任务

对Issue进行**全面技术调研**，为阶段2提供坚实基础。

⚠️ **本阶段禁止提出解决方案**，只做信息收集和分析。

## 独立思考要求

- ❌ 不能查看修复该Issue的PR代码（如果存在）
- ❌ 不能查看Issue评论区中直接给出的解决方案
- ✅ 可以查看Issue讨论中对问题的分析
- ✅ 可以查看维护者的回复了解技术限制

## 关键原则

⚠️ **堆栈≠根因** - 不要只看错误堆栈指向的函数，必须全面检查所有相关函数(CRUD)和调用链

⚠️ **精准定位** - Issue指向哪个文件/行号，调研重点就放在那里，不要发散到"相关"文件

⚠️ **不做假设** - 不要假设问题已被其他PR修复，不要基于错误日志表象推断根因

---

## 强制调研清单

### 1. 找相似实现 ⭐⭐⭐（最关键）

```bash
# 同目录查找类似资源
ls -la path/to/resource/directory/

# 例如：pim_eligible → 找 pim_active
# 对比两者差异，理解为何其他资源没此问题
```

**必须记录**：
- 相似资源文件路径
- 关键实现差异
- 为何它没问题

### 2. 搜SDK工具 ⭐⭐

```bash
# 搜索验证函数
grep -r "Validate.*ID\|Parse.*ID" vendor/

# 检查已导入的SDK包
```

**必须记录**：
- 找到的SDK函数名称和路径
- 是否适用当前场景

### 3. 查代码历史 ⭐

```bash
# 查找最近修改
git log --oneline -20 -- path/to/file.go

# 搜索特定字段变更
git log -p -S "field_name" -- path/to/file.go
```

**必须记录**：
- 最近3个月相关commits
- 问题可能引入的时间点

### 4. 识别全局影响

```bash
# 搜索字段所有使用位置
grep -r "field_name" internal/services/
```

**必须记录**：
- Create/Update/Read/Delete函数位置
- 相关资源（嵌套配置等）
- 需要同步修改的位置

### 5. 官方文档

- 查Azure/AWS文档的推荐做法
- 确认API的预期行为

---

## 输出要求

创建 `issue-[编号]-research.md`，包含：

```markdown
# Issue #[编号] 调研报告

## 问题概述
[简述问题、涉及资源、错误信息]

## 初步假设
1. 假设A - 待验证
2. 假设B - 待验证

## 代码定位
- 主要文件：[路径]
- 关键函数：[名称] (行号)

## 相似实现对比 ⭐
- 相似资源：[文件路径]
- 关键差异：[它用X，当前用Y]
- 为何没问题：[原因]

## SDK工具 ⭐
- 函数：`XXX.ValidateYYY` 
- 路径：[包路径]
- 适用性：是/否，[原因]

## 历史分析
- Commit [hash]: [说明]
- 问题引入时间：[估计]

## 全局影响
- [ ] Create函数 (路径:行)
- [ ] Update函数 (路径:行)
- [ ] Read函数 (路径:行)
- [ ] Delete函数 (路径:行)
- [ ] 相关资源：[名称]

## 关键发现 ⭐
1. [最重要的发现]
2. [第二重要]
3. [第三重要]

## 下一步建议
- [ ] 优先验证假设[X]
- [ ] 参考[相似实现]
- [ ] 使用SDK函数[名称]
- [ ] 修改所有[位置列表]
```

---

## 质量检查

完成前确认：
- [ ] 找到至少1个相似实现
- [ ] 搜索了SDK工具函数
- [ ] 查看了git历史
- [ ] 识别了Issue指向的具体位置（文件/行号）
- [ ] 读了官方文档
- [ ] **没有假设问题已被其他PR修复**
- [ ] **调研范围与Issue描述一致，没有发散**
